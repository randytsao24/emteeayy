<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>emteeayy - NYC Transit</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600&family=DM+Serif+Display&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.15.8/dist/cdn.min.js"
    ></script>
    <script src="app.js"></script>
  </head>
  <body>
    <div class="container" x-data="transitApp()">
      <header>
        <h1>emteeayy</h1>
        <p class="tagline">nyc transit arrivals for the privacy-minded</p>
        <p class="clock" x-text="clock"></p>
      </header>

      <div class="search-box">
        <div class="tabs">
          <button
            class="tab"
            :class="{ active: currentMode === 'subway' }"
            @click="setMode('subway')"
          >Subway</button>
          <button
            class="tab"
            :class="{ active: currentMode === 'bus' }"
            @click="setMode('bus')"
          >Bus</button>
          <select class="radius-select" x-model="radius" @change="refresh()">
            <option value="400">0.25 mi</option>
            <option value="800">0.5 mi</option>
            <option value="1600">1 mi</option>
            <option value="3200">2 mi</option>
          </select>
        </div>
        <button
          class="btn-secondary"
          @click="useLocation()"
          :disabled="locating"
          x-text="locating ? 'Getting location...' : 'Use my location'"
        ></button>
        <div class="divider">or</div>
        <form @submit.prevent="submitZip()">
          <div class="input-group">
            <input
              type="text"
              x-model="zipValue"
              x-ref="zipInput"
              placeholder="Enter NYC zip code"
              maxlength="5"
              pattern="[0-9]{5}"
            />
            <button type="submit" class="btn-primary">Go</button>
          </div>
        </form>
      </div>

      <p class="location-info" x-show="locationText" x-text="locationText"></p>
      <div class="error" x-show="error" x-text="error"></div>

      <div class="loading" x-show="loading">
        <div class="spinner"></div>
        <p
          x-text="currentMode === 'subway' ? 'Finding nearby trains...' : 'Finding nearby buses...'"
        ></p>
      </div>

      <div class="results" x-show="!loading">
        <!-- Subway results -->
        <div x-show="currentMode === 'subway'">
          <p class="no-arrivals" x-show="lastUpdated && stations.length === 0">
            No subway stations found nearby. Try a different location.
          </p>
          <template x-for="station in stations" :key="station.stop_id">
            <div class="station">
              <div class="station-header">
                <a
                  class="station-name station-nav-link"
                  :href="`https://www.google.com/maps/dir/?api=1&destination=${station.stop_lat},${station.stop_lon}&travelmode=walking`"
                  target="_blank"
                  rel="noopener noreferrer"
                  x-text="station.stop_name || station.stop_id"
                ></a>
                <span
                  class="station-distance"
                  x-text="(station.distance_miles ? station.distance_miles.toFixed(2) : '?') + ' mi'"
                ></span>
              </div>
              <p
                class="no-arrivals"
                x-show="!station.northbound?.length && !station.southbound?.length"
              >
                No upcoming arrivals
              </p>
              <div
                class="direction"
                x-show="station.northbound && station.northbound.length > 0"
              >
                <div class="direction-label">Northbound / Manhattan</div>
                <div class="trains">
                  <template
                    x-for="(arr, i) in (station.northbound || []).slice(0, 4)"
                    :key="i"
                  >
                    <div class="train">
                      <span
                        class="line-badge"
                        x-text="arr.route || '?'"
                        :style="`background:${getLineColor(arr.route)};color:${isLightLine(arr.route) ? '#333' : '#fff'}`"
                      ></span>
                      <span
                        class="train-time"
                        x-text="formatTime(arr.minutes_away)"
                      ></span>
                    </div>
                  </template>
                </div>
              </div>
              <div
                class="direction"
                x-show="station.southbound && station.southbound.length > 0"
              >
                <div class="direction-label">Southbound / Brooklyn</div>
                <div class="trains">
                  <template
                    x-for="(arr, i) in (station.southbound || []).slice(0, 4)"
                    :key="i"
                  >
                    <div class="train">
                      <span
                        class="line-badge"
                        x-text="arr.route || '?'"
                        :style="`background:${getLineColor(arr.route)};color:${isLightLine(arr.route) ? '#333' : '#fff'}`"
                      ></span>
                      <span
                        class="train-time"
                        x-text="formatTime(arr.minutes_away)"
                      ></span>
                    </div>
                  </template>
                </div>
              </div>
            </div>
          </template>
        </div>

        <!-- Bus results -->
        <div x-show="currentMode === 'bus'">
          <p class="no-arrivals" x-show="lastUpdated && busStops.length === 0">
            No buses found nearby. Try a different location.
          </p>
          <template x-for="stop in busStops" :key="stop.name">
            <div class="bus-stop">
              <div class="stop-header">
                <span class="stop-name" x-text="stop.name"></span>
              </div>
              <template x-for="(arr, i) in stop.arrivals.slice(0, 5)" :key="i">
                <div class="bus-arrival">
                  <div class="bus-info">
                    <span class="bus-route" x-text="arr.route"></span>
                    <span
                      class="bus-destination"
                      x-text="arr.destination && arr.destination.length > 30 ? arr.destination.substring(0, 30) + '...' : (arr.destination || '')"
                    ></span>
                  </div>
                  <span
                    class="bus-time"
                    x-text="formatTime(arr.minutes_away)"
                  ></span>
                </div>
              </template>
            </div>
          </template>
        </div>

        <p class="last-updated" x-show="lastUpdated">
          Updated <span x-text="lastUpdated"></span>
          &middot;
          <button class="btn-link" @click="refresh()">Refresh</button>
        </p>
      </div>

      <footer>
        <p><strong>Attention!</strong> This website does NOT collect, store, or share any of your data.</p>
        <p>
          Real-time data from
          <a href="https://new.mta.info/developers" target="_blank">MTA</a>
          &middot;
          <a href="/api" target="_blank">API</a>
        </p>
      </footer>
    </div>
  </body>
</html>
